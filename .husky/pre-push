echo "ğŸ” Pre-push CI check..."

# 1. Format check (fastest â€” catches Prettier drift)
echo "  â†’ format:check"
npm run format:check || {
  echo "âŒ Format check failed. Run: npm run format"
  exit 1
}

# 2. Lint (catches unused vars, import errors)
echo "  â†’ lint"
npm run lint || {
  echo "âŒ Lint failed. Run: npm run lint:fix"
  exit 1
}

# 3. Unit tests (vitest â€” catches assertion mismatches)
echo "  â†’ test"
npm test || {
  echo "âŒ Unit tests failed."
  exit 1
}

# 4. API integration tests (node:test) â€” skip if API is unreachable (sandbox/offline)
if curl -s --connect-timeout 3 https://api.lemedspa.app/api/health > /dev/null 2>&1; then
  echo "  â†’ test:api"
  npm run test:api || {
    echo "âŒ API tests failed."
    exit 1
  }
else
  echo "  â†’ test:api (skipped â€” API unreachable)"
fi

echo "âœ… All CI checks passed â€” pushing."
