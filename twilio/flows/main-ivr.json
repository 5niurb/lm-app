{
	"description": "LeMed Main IVR â€” Updated 2026-02-19",
	"flags": {
		"allow_concurrent_calls": true
	},
	"initial_state": "Trigger",
	"states": [
		{
			"name": "Trigger",
			"properties": {
				"offset": {
					"x": 180,
					"y": -140
				}
			},
			"transitions": [
				{
					"event": "incomingMessage",
					"next": "log_incoming_call"
				},
				{
					"event": "incomingCall",
					"next": "log_incoming_call"
				},
				{
					"event": "incomingConversationMessage"
				},
				{
					"event": "incomingRequest"
				},
				{
					"event": "incomingParent",
					"next": "log_incoming_call"
				}
			],
			"type": "trigger"
		},
		{
			"name": "log_incoming_call",
			"properties": {
				"body": "CallSid={{trigger.call.CallSid}}&From={{trigger.call.From}}&To={{trigger.call.To}}&CallerName={{trigger.call.CallerName}}&CallerCity={{trigger.call.CallerCity}}&CallerState={{trigger.call.CallerState}}&CallerCountry={{trigger.call.CallerCountry}}",
				"content_type": "application/x-www-form-urlencoded;charset=utf-8",
				"method": "POST",
				"offset": {
					"x": 180,
					"y": -10
				},
				"url": "https://api.lemedspa.app/api/webhooks/voice/incoming"
			},
			"transitions": [
				{
					"event": "success",
					"next": "x0a-MainGreetingMenu_Open"
				},
				{
					"event": "failed",
					"next": "x0a-MainGreetingMenu_Open"
				}
			],
			"type": "make-http-request"
		},
		{
			"name": "x0a-MainGreetingMenu_Open",
			"properties": {
				"gather_language": "en-US",
				"loop": 1,
				"number_of_digits": 1,
				"offset": {
					"x": 310,
					"y": 80
				},
				"play": "https://periwinkle-partridge-9538.twil.io/assets/0a-LM_Main_Greeting_9.14.25.wav",
				"profanity_filter": "false",
				"speech_model": "default",
				"speech_timeout": "10",
				"stop_gather": true,
				"timeout": 5
			},
			"transitions": [
				{
					"event": "keypress",
					"next": "split_digits_GreetingMenu"
				},
				{
					"event": "speech"
				},
				{
					"event": "timeout",
					"next": "connect_operator_redirect"
				}
			],
			"type": "gather-input-on-call"
		},
		{
			"name": "split_digits_GreetingMenu",
			"properties": {
				"input": "{{widgets.x0a-MainGreetingMenu_Open.Digits}}",
				"offset": {
					"x": 660,
					"y": 360
				}
			},
			"transitions": [
				{
					"event": "noMatch"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x0a-MainGreetingMenu_Open.Digits}}"],
							"friendly_name": "0",
							"type": "equal_to",
							"value": "0"
						}
					],
					"event": "match",
					"next": "connect_operator_redirect"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x0a-MainGreetingMenu_Open.Digits}}"],
							"friendly_name": "1",
							"type": "equal_to",
							"value": "1"
						}
					],
					"event": "match",
					"next": "send_message_accounts"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x0a-MainGreetingMenu_Open.Digits}}"],
							"friendly_name": "2",
							"type": "equal_to",
							"value": "2"
						}
					],
					"event": "match",
					"next": "x2a-Hours_Location"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x0a-MainGreetingMenu_Open.Digits}}"],
							"friendly_name": "3",
							"type": "equal_to",
							"value": "3"
						}
					],
					"event": "match",
					"next": "x2b-Company_Directory"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x0a-MainGreetingMenu_Open.Digits}}"],
							"friendly_name": "4",
							"type": "equal_to",
							"value": "4"
						}
					],
					"event": "match"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x0a-MainGreetingMenu_Open.Digits}}"],
							"friendly_name": "9",
							"type": "equal_to",
							"value": "9"
						}
					],
					"event": "match"
				}
			],
			"type": "split-based-on"
		},
		{
			"name": "connect_operator_redirect",
			"properties": {
				"method": "POST",
				"offset": {
					"x": 1340,
					"y": 550
				},
				"timeout": "14400",
				"url": "https://api.lemedspa.app/api/twilio/connect-operator"
			},
			"transitions": [
				{
					"event": "return"
				},
				{
					"event": "timeout"
				},
				{
					"event": "fail"
				}
			],
			"type": "add-twiml-redirect"
		},
		{
			"name": "x2a-Hours_Location",
			"properties": {
				"finish_on_key": "#",
				"gather_language": "en-US",
				"loop": 1,
				"number_of_digits": 1,
				"offset": {
					"x": -40,
					"y": 600
				},
				"play": "https://periwinkle-partridge-9538.twil.io/assets/2a-HoursLocation.wav",
				"profanity_filter": "true",
				"speech_model": "default",
				"speech_timeout": "10",
				"stop_gather": true,
				"timeout": 5
			},
			"transitions": [
				{
					"event": "keypress",
					"next": "split_hours"
				},
				{
					"event": "speech"
				},
				{
					"event": "timeout"
				}
			],
			"type": "gather-input-on-call"
		},
		{
			"name": "split_hours",
			"properties": {
				"input": "{{widgets.x2a-Hours_Location.Digits}}",
				"offset": {
					"x": -230,
					"y": 900
				}
			},
			"transitions": [
				{
					"event": "noMatch",
					"next": "x0a-MainGreetingMenu_Open"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x2a-Hours_Location.Digits}}"],
							"friendly_name": "If value equal_to 9",
							"type": "equal_to",
							"value": "9"
						}
					],
					"event": "match",
					"next": "x2a-Hours_Location"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x2a-Hours_Location.Digits}}"],
							"friendly_name": "If value equal_to 0",
							"type": "equal_to",
							"value": "0"
						}
					],
					"event": "match"
				}
			],
			"type": "split-based-on"
		},
		{
			"name": "x2b-Company_Directory",
			"properties": {
				"finish_on_key": "#",
				"gather_language": "English (United States)",
				"loop": 1,
				"offset": {
					"x": 370,
					"y": 760
				},
				"play": "https://periwinkle-partridge-9538.twil.io/assets/2b-CompanyDirectory.wav",
				"speech_model": "default",
				"speech_timeout": "auto",
				"stop_gather": true,
				"timeout": 5
			},
			"transitions": [
				{
					"event": "keypress",
					"next": "split_companyDir"
				},
				{
					"event": "speech"
				},
				{
					"event": "timeout"
				}
			],
			"type": "gather-input-on-call"
		},
		{
			"name": "split_companyDir",
			"properties": {
				"input": "{{widgets.x2b-Company_Directory.Digits}}",
				"offset": {
					"x": 1060,
					"y": 820
				}
			},
			"transitions": [
				{
					"event": "noMatch",
					"next": "x2b-Company_Directory"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x2b-Company_Directory.Digits}}"],
							"friendly_name": "1",
							"type": "equal_to",
							"value": "1"
						}
					],
					"event": "match",
					"next": "gather_lea_vmail"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x2b-Company_Directory.Digits}}"],
							"friendly_name": "2",
							"type": "equal_to",
							"value": "2"
						}
					],
					"event": "match",
					"next": "gather_clinicalmd_vmail"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x2b-Company_Directory.Digits}}"],
							"friendly_name": "3",
							"type": "equal_to",
							"value": "3"
						}
					],
					"event": "match",
					"next": "x3c-AccountsOps_Menu"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x2b-Company_Directory.Digits}}"],
							"friendly_name": "0",
							"type": "equal_to",
							"value": "0"
						}
					],
					"event": "match"
				}
			],
			"type": "split-based-on"
		},
		{
			"name": "gather_lea_vmail",
			"properties": {
				"gather_language": "en-US",
				"loop": 1,
				"number_of_digits": 1,
				"offset": {
					"x": 320,
					"y": 1100
				},
				"say": "You've reached Lea's voicemail. Leave a message after the beep, or press 1 to start a two-way text conversation.",
				"stop_gather": true,
				"timeout": 5,
				"voice": "Polly.Joanna"
			},
			"transitions": [
				{
					"event": "keypress",
					"next": "send_sms_lea"
				},
				{
					"event": "speech"
				},
				{
					"event": "timeout",
					"next": "record_lea_vmail"
				}
			],
			"type": "gather-input-on-call"
		},
		{
			"name": "send_sms_lea",
			"properties": {
				"body": "{\"to\":\"{{contact.channel.address}}\",\"body\":\"(LeMedSpa) Thank you for reaching out. How can we help you?\",\"callSid\":\"{{trigger.call.CallSid}}\"}",
				"content_type": "application/json;charset=utf-8",
				"method": "POST",
				"offset": {
					"x": 100,
					"y": 1370
				},
				"url": "https://api.lemedspa.app/api/webhooks/sms/studio-send"
			},
			"transitions": [
				{
					"event": "success",
					"next": "play_sms_sent_goodbye"
				},
				{
					"event": "failed",
					"next": "record_lea_vmail"
				}
			],
			"type": "make-http-request"
		},
		{
			"name": "record_lea_vmail",
			"properties": {
				"max_length": 3600,
				"offset": {
					"x": 320,
					"y": 1570
				},
				"play_beep": "true",
				"recording_status_callback": "https://api.lemedspa.app/api/webhooks/voice/recording?mailbox=lea",
				"timeout": 5,
				"transcribe": false,
				"trim": "trim-silence"
			},
			"transitions": [
				{
					"event": "recordingComplete"
				},
				{
					"event": "noAudio"
				},
				{
					"event": "hangup"
				}
			],
			"type": "record-voicemail"
		},
		{
			"name": "gather_clinicalmd_vmail",
			"properties": {
				"gather_language": "en-US",
				"loop": 1,
				"number_of_digits": 1,
				"offset": {
					"x": 790,
					"y": 1100
				},
				"say": "You've reached the clinical team's voicemail. Leave a message after the beep, or press 1 to start a two-way text conversation.",
				"stop_gather": true,
				"timeout": 5,
				"voice": "Polly.Joanna"
			},
			"transitions": [
				{
					"event": "keypress",
					"next": "send_sms_clinicalmd"
				},
				{
					"event": "speech"
				},
				{
					"event": "timeout",
					"next": "record_clinicalmd_vmail"
				}
			],
			"type": "gather-input-on-call"
		},
		{
			"name": "send_sms_clinicalmd",
			"properties": {
				"body": "{\"to\":\"{{contact.channel.address}}\",\"body\":\"(LeMedSpa) Thank you for reaching out. How can we help you?\",\"callSid\":\"{{trigger.call.CallSid}}\"}",
				"content_type": "application/json;charset=utf-8",
				"method": "POST",
				"offset": {
					"x": 590,
					"y": 1370
				},
				"url": "https://api.lemedspa.app/api/webhooks/sms/studio-send"
			},
			"transitions": [
				{
					"event": "success",
					"next": "play_sms_sent_goodbye"
				},
				{
					"event": "failed",
					"next": "record_clinicalmd_vmail"
				}
			],
			"type": "make-http-request"
		},
		{
			"name": "record_clinicalmd_vmail",
			"properties": {
				"max_length": 3600,
				"offset": {
					"x": 990,
					"y": 1370
				},
				"play_beep": "true",
				"recording_status_callback": "https://api.lemedspa.app/api/webhooks/voice/recording?mailbox=clinical_md",
				"timeout": 5,
				"transcribe": false,
				"trim": "trim-silence"
			},
			"transitions": [
				{
					"event": "recordingComplete"
				},
				{
					"event": "noAudio"
				},
				{
					"event": "hangup"
				}
			],
			"type": "record-voicemail"
		},
		{
			"name": "x3c-AccountsOps_Menu",
			"properties": {
				"finish_on_key": "#",
				"gather_language": "English (United States)",
				"loop": 1,
				"offset": {
					"x": 1380,
					"y": 1110
				},
				"play": "https://periwinkle-partridge-9538.twil.io/assets/3c-Accounts%20Greeting%20Menu%20(Elabs%20Will).mp3",
				"speech_timeout": "auto",
				"stop_gather": true,
				"timeout": 5
			},
			"transitions": [
				{
					"event": "keypress",
					"next": "split_accountsmenu_digits"
				},
				{
					"event": "speech"
				},
				{
					"event": "timeout"
				}
			],
			"type": "gather-input-on-call"
		},
		{
			"name": "split_accountsmenu_digits",
			"properties": {
				"input": "{{widgets.x3c-AccountsOps_Menu.Digits}}",
				"offset": {
					"x": 1120,
					"y": 1390
				}
			},
			"transitions": [
				{
					"event": "noMatch"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x3c-AccountsOps_Menu.Digits}}"],
							"friendly_name": "1",
							"type": "equal_to",
							"value": "1"
						}
					],
					"event": "match",
					"next": "send_message_accounts"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x3c-AccountsOps_Menu.Digits}}"],
							"friendly_name": "2",
							"type": "equal_to",
							"value": "2"
						}
					],
					"event": "match",
					"next": "gather_accounts_vmail"
				},
				{
					"conditions": [
						{
							"arguments": ["{{widgets.x3c-AccountsOps_Menu.Digits}}"],
							"friendly_name": "3",
							"type": "equal_to",
							"value": "3"
						}
					],
					"event": "match",
					"next": "connect_call_accounts"
				}
			],
			"type": "split-based-on"
		},
		{
			"name": "send_message_accounts",
			"properties": {
				"body": "{\"to\":\"{{contact.channel.address}}\",\"body\":\"(LeMedSpa) Thank you for reaching out. How can we help you?\",\"callSid\":\"{{trigger.call.CallSid}}\"}",
				"content_type": "application/json;charset=utf-8",
				"method": "POST",
				"offset": {
					"x": 670,
					"y": 1570
				},
				"url": "https://api.lemedspa.app/api/webhooks/sms/studio-send"
			},
			"transitions": [
				{
					"event": "success",
					"next": "play_MsgSentGoodbye"
				},
				{
					"event": "failed",
					"next": "gather_accounts_vmail"
				}
			],
			"type": "make-http-request"
		},
		{
			"name": "gather_accounts_vmail",
			"properties": {
				"gather_language": "en-US",
				"loop": 1,
				"number_of_digits": 1,
				"offset": {
					"x": 1020,
					"y": 1580
				},
				"say": "You've reached our accounts department voicemail. Leave a message after the beep, or press 1 to start a two-way text conversation.",
				"stop_gather": true,
				"timeout": 5,
				"voice": "Polly.Joanna"
			},
			"transitions": [
				{
					"event": "keypress",
					"next": "send_sms_accounts_vmail"
				},
				{
					"event": "speech"
				},
				{
					"event": "timeout",
					"next": "record_accounts_vmail"
				}
			],
			"type": "gather-input-on-call"
		},
		{
			"name": "send_sms_accounts_vmail",
			"properties": {
				"body": "{\"to\":\"{{contact.channel.address}}\",\"body\":\"(LeMedSpa) Thank you for reaching out. How can we help you?\",\"callSid\":\"{{trigger.call.CallSid}}\"}",
				"content_type": "application/json;charset=utf-8",
				"method": "POST",
				"offset": {
					"x": 820,
					"y": 1800
				},
				"url": "https://api.lemedspa.app/api/webhooks/sms/studio-send"
			},
			"transitions": [
				{
					"event": "success",
					"next": "play_sms_sent_goodbye"
				},
				{
					"event": "failed",
					"next": "record_accounts_vmail"
				}
			],
			"type": "make-http-request"
		},
		{
			"name": "record_accounts_vmail",
			"properties": {
				"max_length": 3600,
				"offset": {
					"x": 1120,
					"y": 1800
				},
				"play_beep": "true",
				"recording_status_callback": "https://api.lemedspa.app/api/webhooks/voice/recording?mailbox=accounts",
				"timeout": 5,
				"transcribe": false,
				"trim": "trim-silence"
			},
			"transitions": [
				{
					"event": "recordingComplete"
				},
				{
					"event": "noAudio"
				},
				{
					"event": "hangup"
				}
			],
			"type": "record-voicemail"
		},
		{
			"name": "connect_call_accounts",
			"properties": {
				"caller_id": "{{contact.channel.address}}",
				"noun": "number",
				"offset": {
					"x": 1390,
					"y": 1640
				},
				"timeout": 30,
				"to": "+12134442242"
			},
			"transitions": [
				{
					"event": "callCompleted"
				},
				{
					"event": "hangup"
				}
			],
			"type": "connect-call-to"
		},
		{
			"name": "play_MsgSentGoodbye",
			"properties": {
				"loop": 1,
				"offset": {
					"x": 400,
					"y": 1820
				},
				"play": "https://periwinkle-partridge-9538.twil.io/assets/1a1-messageSentGoodbye.wav"
			},
			"transitions": [
				{
					"event": "audioComplete"
				}
			],
			"type": "say-play"
		},
		{
			"name": "play_sms_sent_goodbye",
			"properties": {
				"loop": 1,
				"offset": {
					"x": 100,
					"y": 1620
				},
				"say": "A text message has been sent to your phone. You can reply directly to that message. Goodbye.",
				"voice": "Polly.Joanna"
			},
			"transitions": [
				{
					"event": "audioComplete"
				}
			],
			"type": "say-play"
		}
	]
}
